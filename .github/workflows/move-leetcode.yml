name: Move LeetCode Solutions

on:
  workflow_dispatch:
  push:
    branches:
      - main
      - master
    paths-ignore:
      - 'LeetCode/**'
      - '.github/**'
      - '백준/**'
      - 'SWEA/**'
      - '프로그래머스/**'

jobs:
  move-files:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Pull latest changes
        run: |
          git pull origin main --rebase

      - name: Move LeetCode solutions
        run: |
          mkdir -p LeetCode
          
          echo "=== Looking for LeetCode problems ==="
          moved=false
          
          # 루트에 있는 숫자로 시작하는 모든 디렉토리 찾기
          for dir in [0-9]*; do
            if [ -d "$dir" ] && [ "$dir" != "LeetCode" ]; then
              # 이미 LeetCode 폴더에 있으면 삭제 후 이동
              if [ -d "LeetCode/$dir" ]; then
                echo "Removing existing LeetCode/$dir"
                rm -rf "LeetCode/$dir"
              fi
              echo "Moving: $dir to LeetCode/"
              mv "$dir" "LeetCode/"
              moved=true
            fi
          done
          
          # 하이픈이 포함된 디렉토리도 체크
          for dir in *-*; do
            if [ -d "$dir" ] && [[ "$dir" =~ ^[a-z] ]] && [ "$dir" != "LeetCode" ]; then
              if [ -d "LeetCode/$dir" ]; then
                echo "Removing existing LeetCode/$dir"
                rm -rf "LeetCode/$dir"
              fi
              echo "Moving: $dir to LeetCode/"
              mv "$dir" "LeetCode/"
              moved=true
            fi
          done
          
          if [ "$moved" = true ]; then
            echo "Successfully moved directories"
          else
            echo "No directories to move"
          fi

      - name: Commit and Push changes
        run: |
          git config user.name 'github-actions[bot]'
          git config user.email 'github-actions[bot]@users.noreply.github.com'
          
          if [ -n "$(git status --porcelain)" ]; then
            git add -A
            git commit -m "📁 Auto-organize: Move LeetCode solutions to LeetCode folder"
            git pull --rebase origin main
            git push
          else
            echo "No changes to commit"
          fi
